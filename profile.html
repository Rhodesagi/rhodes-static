<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - RHODES</title>
    <link rel="stylesheet" href="/rhodes.css?v=20260115-06">
    <style>
        body { background: var(--bg); color: var(--text); font-family: "Orbitron", "Segoe UI", monospace; margin: 0; padding: 20px; min-height: 100vh; overflow-y: auto; box-sizing: border-box; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: var(--cyan); font-size: 24px; margin-bottom: 30px; }
        .back-link { color: var(--cyan); text-decoration: none; font-size: 14px; display: inline-block; margin-bottom: 20px; }
        .back-link:hover { text-decoration: underline; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: var(--dim); font-size: 12px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 12px;
            background: var(--panel); border: 1px solid var(--border);
            color: var(--text); font-family: inherit; font-size: 14px;
            border-radius: 3px; box-sizing: border-box;
        }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--cyan); outline: none; }
        .form-group input:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn {
            padding: 12px 24px; background: transparent;
            border: 1px solid var(--green); color: var(--green);
            font-family: 'Orbitron', monospace; cursor: pointer; font-size: 14px;
            border-radius: 3px;
        }
        .btn:hover { background: rgba(0, 255, 65, 0.1); }
        .btn-danger { border-color: var(--red); color: var(--red); }
        .btn-danger:hover { background: rgba(255, 0, 100, 0.1); }
        .message { padding: 10px 15px; margin-bottom: 20px; border-radius: 3px; font-size: 13px; }
        .message.success { background: rgba(0, 255, 65, 0.1); border: 1px solid var(--green); color: var(--green); }
        .message.error { background: rgba(255, 0, 100, 0.1); border: 1px solid var(--red); color: var(--red); }
        .section { background: var(--panel); border: 1px solid var(--border); padding: 20px; margin-bottom: 20px; border-radius: 3px; }
        .section h2 { color: var(--cyan); font-size: 16px; margin: 0 0 20px 0; }
        .readonly-info { color: var(--dim); font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">&larr; Back to RHODES</a>
        <h1>// PROFILE</h1>

        <div id="message" class="message" style="display:none;"></div>

        <div class="section">
            <h2>Account Info</h2>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username" disabled>
                <div class="readonly-info">Username cannot be changed</div>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email">
                
            </div>
            <div class="form-group">
                <label>Member Since</label>
                <input type="text" id="member-since" disabled>
            </div>
        </div>

        <div class="section">
            <h2>Profile</h2>
            <div class="form-group">
                <label>Display Name (Alias)</label>
                <input type="text" id="alias" placeholder="Optional display name">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="phone" placeholder="Optional phone number">
            </div>
            <button class="btn" onclick="saveProfile()">Save Profile</button>
        </div>

        <div class="section">
            <h2>Change Password</h2>
            <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="current-password">
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" id="new-password" placeholder="At least 6 characters">
            </div>
            <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" id="confirm-password">
            </div>
            <button class="btn" onclick="changePassword()">Change Password</button>
        </div>
    </div>

    <script>
        const USER_TOKEN = localStorage.getItem('rhodes_user_token') || '';

        if (!USER_TOKEN) {
            window.location.href = '/?login=1';
        }

        async function loadProfile() {
            try {
                const resp = await fetch('/api/user/profile', {
                    headers: { 'Authorization': 'Bearer ' + USER_TOKEN }
                });
                if (!resp.ok) throw new Error('Failed to load profile');
                const data = await resp.json();

                document.getElementById('username').value = data.username || '';
                document.getElementById('email').value = data.email || '';
                document.getElementById('alias').value = data.alias || '';
                document.getElementById('phone').value = data.phone || '';

                if (data.created_at) {
                    const date = new Date(data.created_at * 1000);
                    document.getElementById('member-since').value = date.toLocaleDateString();
                }
            } catch (e) {
                showMessage('error', 'Failed to load profile: ' + e.message);
            }
        }

        async function saveProfile() {
            try {
                const resp = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'Bearer ' + USER_TOKEN,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        alias: document.getElementById("alias").value,
                        email: document.getElementById("email").value,
                        phone: document.getElementById('phone').value
                    })
                });
                if (!resp.ok) throw new Error('Failed to save profile');
                showMessage('success', 'Profile updated successfully');
            } catch (e) {
                showMessage('error', 'Failed to save: ' + e.message);
            }
        }

        async function changePassword() {
            const currentPw = document.getElementById('current-password').value;
            const newPw = document.getElementById('new-password').value;
            const confirmPw = document.getElementById('confirm-password').value;

            if (!currentPw || !newPw) {
                showMessage('error', 'Please fill in all password fields');
                return;
            }
            if (newPw !== confirmPw) {
                showMessage('error', 'New passwords do not match');
                return;
            }
            if (newPw.length < 6) {
                showMessage('error', 'New password must be at least 6 characters');
                return;
            }

            showMessage('error', 'Password change not yet implemented via this interface. Use the main site password reset.');
        }

        function showMessage(type, text) {
            const msg = document.getElementById('message');
            msg.className = 'message ' + type;
            msg.textContent = text;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 5000);
        }

        loadProfile();
    </script>
</body>
</html>
